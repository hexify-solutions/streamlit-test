# Official Lex AI v1

Advance medical symtoms checker application.


## 1. JSON Schema for Events

This schema validates all event messages from the app:

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "PatientAppEvent",
  "type": "object",
  "properties": {
    "event": {
      "type": "string",
      "enum": [
        "INITIATED",
        "PATIENT_DATA_LOADED",
        "QUESTION_ASKED",
        "RECOMMENDATION",
        "RESULTS",
        "BOOK_APPOINTMENT",
        "DONE",
        "ERROR",
        "WARNING"
      ]
    },
    "data": {
      "type": "object",
      "description": "Event-specific data payload"
    },
    "patientId": {
      "type": "string",
      "description": "The unique patient identifier"
    }
  },
  "required": ["event", "patientId"]
}
```


---

## 2. Integration Guide

### Overview

The **Lex AI App** can be embedded in any web application using an iframe. It communicates via `window.postMessage` for sending and receiving events.

You are expected to provide following data to enable us profile needed credentials.


| Parameter    | Required | Description                |
| ------------ | -------- | -------------------------- |
| `origin domain` | Yes      | where would the app be used  |
| `get patient api url` | Yes      | API to retrieve the patient health records  |
| `post result api url`    | Yes      | API to send final recommendations to |

---

### Iframe Parameters

| Parameter    | Required | Description                |
| ------------ | -------- | -------------------------- |
| `patient_id` | Yes      | Unique patient identifier  |
| `session_id` | Yes      | Unique session identifier  |
| `api_key`    | Yes      | API key for authentication |

**Example URL**

```
https://lex-ai.streamlit.app?patient_id=123&session_id=abc123&api_key=YOUR_API_KEY
```

---

### Event Payload

| Field       | Type   | Description                      |
| ----------- | ------ | -------------------------------- |
| `event`     | string | One of the supported event names |
| `data`      | object | Event-specific payload           |
| `patientId` | string | Patient ID for this session      |

**Supported Events**

| Event Name            | Direction    | Description                         |
| --------------------- | ------------ | ----------------------------------- |
| `INITIATED`           | App → Parent | App loaded and initialized          |
| `PATIENT_DATA_LOADED` | App → Parent | Patient profile successfully loaded |
| `QUESTION_ASKED`      | App → Parent | Question submitted by user          |
| `RECOMMENDATION`      | App → Parent | Recommendation generated by the app |
| `RESULTS`             | App → Parent | Results submitted successfully      |
| `BOOK_APPOINTMENT`    | App → Parent | Appointment scheduled               |
| `DONE`                | App → Parent | Workflow completed                  |
| `ERROR`               | App → Parent | An error occurred                   |
| `WARNING`             | App → Parent | Non-critical warning message        |

---

### Embedding the App

#### Plain HTML Example

```html
<iframe
  src="https://your-streamlit-app.streamlit.app?patient_id=123&session_id=abc123&api_key=YOUR_API_KEY"
  width="800"
  height="600"
  style="border:none;"
  id="patientApp">
</iframe>
```

---

### Listening for Events

#### ReactJS Example

```jsx
import { useEffect, useRef } from "react";

export default function PatientApp() {
  const iframeRef = useRef(null);
  const APP_ORIGIN = "https://your-streamlit-app.streamlit.app";

  useEffect(() => {
    function handleMessage(event) {
      if (event.origin !== APP_ORIGIN) return;
      const { event: ev, data, patientId } = event.data;
      console.log("Event received:", ev, data, patientId);

      switch (ev) {
        case "INITIATED":
          console.log("App initialized");
          break;
        case "PATIENT_DATA_LOADED":
          console.log("Patient data:", data);
          break;
        case "DONE":
          console.log("Workflow completed");
          break;
        case "ERROR":
          console.error("Error:", data);
          break;
      }
    }

    window.addEventListener("message", handleMessage);
    return () => window.removeEventListener("message", handleMessage);
  }, []);

  return (
    <iframe
      ref={iframeRef}
      src={`${APP_ORIGIN}?patient_id=123&session_id=abc123&api_key=YOUR_API_KEY`}
      width="800"
      height="600"
      style={{ border: "none" }}
      id="patientApp"
    />
  );
}
```

---

#### Vue 3 Example

```edge
<template>
  <iframe
    ref="patientApp"
    :src="iframeUrl"
    width="800"
    height="600"
    style="border:none;"
  ></iframe>
</template>

<script setup>
import { onMounted, onBeforeUnmount, ref } from "vue";

const APP_ORIGIN = "https://your-streamlit-app.streamlit.app";
const iframeUrl = `${APP_ORIGIN}?patient_id=123&session_id=abc123&api_key=YOUR_API_KEY`;
const patientApp = ref(null);

function handleMessage(event) {
  if (event.origin !== APP_ORIGIN) return;
  const { event: ev, data, patientId } = event.data;
  console.log("Event received:", ev, data, patientId);

  switch (ev) {
    case "INITIATED":
      console.log("App initialized");
      break;
    case "PATIENT_DATA_LOADED":
      console.log("Patient data:", data);
      break;
    case "DONE":
      console.log("Workflow completed");
      break;
    case "ERROR":
      console.error("Error:", data);
      break;
  }
}

onMounted(() => window.addEventListener("message", handleMessage));
onBeforeUnmount(() => window.removeEventListener("message", handleMessage));
</script>
```

---

### Sending Commands to the AI App

```js
const iframe = document.getElementById("patientApp").contentWindow;
iframe.postMessage(
  { command: "SET_THEME", value: "dark" },
  "https://your-streamlit-app.streamlit.app"
);
```

